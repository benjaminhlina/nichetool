<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using {nichetools} with SIBER • nichetools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using {nichetools} with SIBER">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nichetools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/using-nichetools-with-the-package-nicheROVER.html">Using {nichetools} with the package nicheROVER</a></li>
    <li><a class="dropdown-item" href="../articles/using-nichetools-with-the-package-SIBER.html">Using {nichetools} with SIBER</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using {nichetools} with SIBER</h1>
            
      

      <div class="d-none name"><code>using-nichetools-with-the-package-SIBER.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="our-objectives">Our Objectives<a class="anchor" aria-label="anchor" href="#our-objectives"></a>
</h3>
<p>The purpose of this vignette is to use <a href="https://cran.r-project.org/package=SIBER" class="external-link">{SIBER}</a> and <a href="https://benjaminhlina.github.io/nichetools/">{nichetools}</a> to
extract and then visualize estimates of trophic niche size and
similarities and Layman community metrics for multiple freshwater fish
using <a href="https://ggplot2.tidyverse.org/" class="external-link">{ggplot2}</a>.</p>
<p>This vignette can be used for additional purposes including
estimating niche size and similarities among different groups of aquatic
and/or terrestrial species. Furthermore, niche size and similarities for
different behaviours exhibited within a population can be made using
behavioural data generated from acoustic telemetry (e.g., differences in
habitat occupancy).</p>
</div>
<div class="section level3">
<h3 id="bring-in-trophic-data">Bring in trophic data<a class="anchor" aria-label="anchor" href="#bring-in-trophic-data"></a>
</h3>
<p>First we will load the necessary packages to preform the analysis and
visualization. We will use <a href="https://cran.r-project.org/package=SIBER" class="external-link">{SIBER}</a> and <a href="https://benjaminhlina.github.io/nichetools/">{nichetools}</a> to
preform the analysis. We will use <a href="">{bayestestR}</a> to
calcuate and extract etis and medians for posterior distubtions that we
want to plot. We will use <a href="https://dplyr.tidyverse.org/" class="external-link">{dplyr}</a>, <a href="https://tidyr.tidyverse.org/" class="external-link">{tidyr}</a>, and <a href="https://purrr.tidyverse.org/" class="external-link">{purrr}</a> to manipulate data and
iterate processes. Lastly, we will use <a href="https://ggplot2.tidyverse.org/" class="external-link">{ggplot2}</a>, <a href="https://wilkelab.org/ggtext/" class="external-link">{ggtext}</a>, and <a href="https://patchwork.data-imaginist.com/" class="external-link">{patchwork}</a> to plot,
add labels, and arrange plots.</p>
<p>I will add that many of the <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> and
<a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a> functions and processes can be replaced using <a href="https://CRAN.R-project.org/package=data.table" class="external-link">{data.table}</a>
which is great when working with large data sets.</p>
<p>WE will first load the packages that were just mentioned</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ---- load packages -----</span></span>
<span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/bayestestR/" class="external-link">bayestestR</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/ggtext/" class="external-link">ggtext</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://benjaminhlina.github.io/nichetools/">nichetools</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SIBER</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span>  <span class="co"># source(here::here("functions",</span></span>
<span>  <span class="co">#                   "siber_fit_transform_bays.R"))</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>For the purpose of the vignette we will be using the
<code>demo.siber.data.2</code> data frame that is available within
<code>{SIBER}</code>. We will first look at the structure of this
dataframe using the <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> function <code><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse()</a></code>
For your purposes you will need to replace this with your data frame
either by loading a csv, rds, or qs, with your data. You can do this
multiple ways, I prefer using <code>readr::read_csv()</code> but base
R’s <code><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv()</a></code> works perfectly fine. Note,
{<code>SIBER</code>} functions do not take <code>tibbles</code> or
<code>data.tables</code> so you will have to convert either to
<code>data.frames</code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">demo.siber.data.2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 150</span></span>
<span><span class="co">## Columns: 4</span></span>
<span><span class="co">## $ iso1      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -11.048902, -8.809360, -9.256212, -8.380952, -10.401561, -7.…</span></span>
<span><span class="co">## $ iso2      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.02044315, 1.97597511, 3.28707260, -1.95750266, -3.11949113…</span></span>
<span><span class="co">## $ group     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "city", "city", "city", "city", "city", "city", "city", "cit…</span></span>
<span><span class="co">## $ community <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "dublin", "dublin", "dublin", "dublin", "dublin", "dublin", …</span></span></code></pre>
<p>You will notice that the community and group column are characters
that are the names of the communities and groups. Similarly, you will
likely have names associated with the communities and groups you are
working with, instead of 1, 2, 3 ect. I advise changing them into
factors thus allow you to know the order for each column. The reason why
this is important, is that functions in <code>{SIBER}</code> use
<code>for</code> loops based on the indexing of the
<code>SiberObject</code>. If this order does not match up you can have
issues with the names of the communities and groups you are working
with. I think it isas you will likely have names associated with the
communities and groups you are working with.</p>
<p>So first I change these into factors, then I preserve the column and
create an id column that is the numerical order that will become the
community and group names fed to <code><a href="https://rdrr.io/pkg/SIBER/man/createSiberObject.html" class="external-link">createSiberObject()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo.siber.data.2</span> <span class="op">&lt;-</span> <span class="va">demo.siber.data.2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span>, </span>
<span>    community <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">community</span><span class="op">)</span>, </span>
<span>    group_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    community_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">community</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">demo.siber.data.2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 150</span></span>
<span><span class="co">## Columns: 6</span></span>
<span><span class="co">## $ iso1         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -11.048902, -8.809360, -9.256212, -8.380952, -10.401561, …</span></span>
<span><span class="co">## $ iso2         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.02044315, 1.97597511, 3.28707260, -1.95750266, -3.11949…</span></span>
<span><span class="co">## $ group        <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> city, city, city, city, city, city, city, city, city, cit…</span></span>
<span><span class="co">## $ community    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> dublin, dublin, dublin, dublin, dublin, dublin, dublin, d…</span></span>
<span><span class="co">## $ group_id     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1…</span></span>
<span><span class="co">## $ community_id <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1…</span></span></code></pre>
<p>After we have done this we are going to create two data frames that
are the names of our communities and groups with their associated id
values. We will use these data frames later on to join up the names,
allowing us to know what estimates belong to which communities and
groups, preserving the names that we have assigned them. Again this is
done because it is unlikely you will have communities and groups named
1, 2, 3 ect. and instead will have actual names.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ---- create name with group and community dataframe ----</span></span>
<span><span class="va">cg_names</span> <span class="op">&lt;-</span> <span class="va">demo.siber.data.2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">group</span>,</span>
<span>           <span class="va">community</span>, </span>
<span>           <span class="va">group_id</span>, </span>
<span>           <span class="va">community_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">community</span>, <span class="va">group</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ---- create community names dataframe ---- </span></span>
<span><span class="va">c_names</span> <span class="op">&lt;-</span> <span class="va">demo.siber.data.2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">community</span>, </span>
<span>           <span class="va">community_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">community</span><span class="op">)</span></span></code></pre></div>
<p>We will then plot our biplot to confirm we have the correct
stucture.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ---- plot to confirm correct structure ----</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">demo.siber.data.2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">iso1</span>, y <span class="op">=</span> <span class="va">iso2</span>,</span>
<span>                             colour <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">community</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"A"</span>, begin <span class="op">=</span> <span class="fl">0.25</span>, end <span class="op">=</span> <span class="fl">0.85</span>,</span>
<span>                         name <span class="op">=</span> <span class="st">"Groups"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span></span>
<span>    base_size <span class="op">=</span> <span class="fl">15</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>    legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.65</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">delta</span><span class="op">^</span><span class="fl">13</span>,<span class="st">"C"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">delta</span><span class="op">^</span><span class="fl">15</span>,<span class="st">"N"</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="using-nichetools-with-the-package-SIBER_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Next we will grab the isotopes we need and the community and group
ids, will will then rename them to community and group. This is
important as <code>creatSiberObject()</code> will 1) only take the
following order with the following names <code>iso1</code>,
<code>iso2</code>, <code>group</code>, <code>community</code> and 2) we
will transform this <code>tibble</code> into a <code>data.frame</code>.
In this case we were using tibbles but we could also be working with
<code>data.table</code> and will need to do the same thing.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo_siber_data</span> <span class="op">&lt;-</span> <span class="va">demo.siber.data.2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iso1</span>, <span class="va">iso2</span>, <span class="va">group_id</span>, <span class="va">community_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    community <span class="op">=</span> <span class="va">community_id</span>, </span>
<span>    group <span class="op">=</span> <span class="va">group_id</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="convert-to-siber-object">Convert to {SIBER} object<a class="anchor" aria-label="anchor" href="#convert-to-siber-object"></a>
</h3>
<p>We will convert to a {SIBER} object, once we have the {SIBER} object
we can start our analysis.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">siber_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SIBER/man/createSiberObject.html" class="external-link">createSiberObject</a></span><span class="op">(</span><span class="va">demo_siber_data</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have converted this to a {SIBER} object we can start
doing some analysis using a Bayesian framework and extracting the
different metrics this analysis produces using functions from
{nichetools}.</p>
</div>
<div class="section level3">
<h3 id="bayesian-ellipse-analysis">Bayesian Ellipse Analysis<a class="anchor" aria-label="anchor" href="#bayesian-ellipse-analysis"></a>
</h3>
<p>We first need to set the parameters to run the model</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># options for running jags</span></span>
<span><span class="va">parms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">parms</span><span class="op">$</span><span class="va">n.iter</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fl">10</span><span class="op">^</span><span class="fl">4</span>   <span class="co"># number of iterations to run the model for</span></span>
<span><span class="va">parms</span><span class="op">$</span><span class="va">n.burnin</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">*</span> <span class="fl">10</span><span class="op">^</span><span class="fl">3</span> <span class="co"># discard the first set of values</span></span>
<span><span class="va">parms</span><span class="op">$</span><span class="va">n.thin</span> <span class="op">&lt;-</span> <span class="fl">10</span>     <span class="co"># thin the posterior by this many</span></span>
<span><span class="va">parms</span><span class="op">$</span><span class="va">n.chains</span> <span class="op">&lt;-</span> <span class="fl">2</span>        <span class="co"># run this many chains</span></span></code></pre></div>
<p>Next we need to define the priors for each parameter of the model.
This includes fitting the ellipses using an Inverse Wishart prior on the
covariance matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Σ</mi><annotation encoding="application/x-tex">\Sigma</annotation></semantics></math>
, and a vague normal prior on the means
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit the ellipses which uses an Inverse Wishart prior on the </span></span>
<span><span class="co"># covariance matrix Sigma, and a vague normal prior on the </span></span>
<span><span class="co"># means.</span></span>
<span><span class="va">priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">priors</span><span class="op">$</span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">priors</span><span class="op">$</span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">priors</span><span class="op">$</span><span class="va">tau.mu</span> <span class="op">&lt;-</span> <span class="fl">1.0E-3</span></span></code></pre></div>
<p>We will now run the model using the function
<code><a href="https://rdrr.io/pkg/SIBER/man/siberMVN.html" class="external-link">siberMVN()</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ellipses_posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SIBER/man/siberMVN.html" class="external-link">siberMVN</a></span><span class="op">(</span><span class="va">siber_example</span>, <span class="va">parms</span>, <span class="va">priors</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extract-posterior-distributions-for-μ-and-σ">Extract posterior distributions for μ and Σ<a class="anchor" aria-label="anchor" href="#extract-posterior-distributions-for-%CE%BC-and-%CF%83"></a>
</h3>
<p>We will first extract posterior distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
using <code><a href="../reference/extract_mu.html">extract_mu()</a></code> in {nichetools}. We will need to set the
argument <code>pkg</code> to <code>"SIBER"</code> and because of what we
are going to do with the data afterwards. We are going to set
<code>data_format</code> to <code>"wide"</code>. This argument takes
<code>"long"</code> or <code>"wide"</code> which dictates whether the
data object returned is in wide or long format. We will also use the
function <code>seperate_wider_delim()</code> from {tidyr} to seperate
teh community and groups names as they are joined by a <code>.</code>.
We then will use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join()</a></code> and the <code>cg_names</code>
data frame we created above to add in the correct community and group
names.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_mu.html">extract_mu</a></span><span class="op">(</span><span class="va">ellipses_posterior</span>, pkg <span class="op">=</span> <span class="st">"SIBER"</span>, </span>
<span>                    data_format <span class="op">=</span> <span class="st">"wide"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html" class="external-link">separate_wider_delim</a></span><span class="op">(</span><span class="va">sample_name</span>, cols_remove <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                       delim <span class="op">=</span> <span class="st">"."</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"community_id"</span>,</span>
<span>                                              <span class="st">"group_id"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">cg_names</span><span class="op">)</span></span></code></pre></div>
<p>We can confirm that the posterior estimates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
are correct by plotting them with {ggplot2}</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_mu</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">d13c</span>, y <span class="op">=</span> <span class="va">d15n</span>,</span>
<span>                               colour <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">demo.siber.data.2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">iso1</span>, y <span class="op">=</span> <span class="va">iso2</span>,</span>
<span>                                 colour <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">community</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"A"</span>, begin <span class="op">=</span> <span class="fl">0.25</span>, end <span class="op">=</span> <span class="fl">0.85</span>,</span>
<span>                         name <span class="op">=</span> <span class="st">"Groups"</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span></span>
<span>    base_size <span class="op">=</span> <span class="fl">15</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    legend.position <span class="op">=</span> <span class="st">"inside"</span>,</span>
<span>    legend.position.inside <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.65</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">delta</span><span class="op">^</span><span class="fl">13</span>,<span class="st">"C"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">delta</span><span class="op">^</span><span class="fl">15</span>,<span class="st">"N"</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="using-nichetools-with-the-package-SIBER_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Notice how there is a density of points in the center of the raw data
with the corresponding colours. This indicates that how the model is
iterating over the groups and communities we have the nameing of
commnites and groups correct.</p>
<p>We are also going to extract
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
in long format for creating ellipse, as the functions that create
ellipse need the data frame of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
to be in long format.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_mu_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_mu.html">extract_mu</a></span><span class="op">(</span><span class="va">ellipses_posterior</span>, pkg <span class="op">=</span> <span class="st">"SIBER"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html" class="external-link">separate_wider_delim</a></span><span class="op">(</span><span class="va">sample_name</span>, cols_remove <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                       delim <span class="op">=</span> <span class="st">"."</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"community_id"</span>,</span>
<span>                                              <span class="st">"group_id"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">cg_names</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Benjamin L. Hlina.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
